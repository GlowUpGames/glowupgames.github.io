<html>
    <head>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	</head>
    <body>
        <! -- Must be Entered to Work -->
		<h1>PlayFab Data Manipulator</h1>
		<h2>Step 1: Enter your PlayFab ID and the X-SecretKey (ask Ashley for it).</h2>
		&emsp; Enter your PlayFab ID
		<input type="text" id="PFIDInput">
		<br><br>
		
		&emsp; Enter the X-SecretKey
		<input type="text" id="xSecretInput">
		<br><br>

		<h2>Step 2: Hit the "Get Character ID" button.</h2>
		&emsp;
		<button type="button" id="getCharacterIDBtn">Get Character ID</button>
		<b id="characterIDText"> </b>
		<br>
		
		
		<h2>Step 3: Now do what you want to do!!</h2>
		<h4>Note: you must close the game and reload for the changes to take effect in-game.</h4>
		
		<! -- Get Buttons -->
		<p> Get Save Data Info: </p>
		&emsp; <button type="button" id="getCharacterSaveDataBtn">Get All Save Data</button>
		<pre id="characterSaveDataText">  </pre>
		<br>
		
		&emsp; <button type="button" id="getCharacterInventoryBtn">Get Character Inventory (Resettable Inventory)</button>
		&emsp; <pre id="characterInventoryText">  </pre>
		<br>
		
		&emsp; <button type="button" id="getUserInventoryBtn">Get User Inventory (Permanent/Minted)</button>
		&emsp; <p id="userInventoryText">  </p>
		<br>

		<! -- Set Story Buttons -->
		<p>Change the Story Save Strings: </p>
		&emsp; <button type="button" id="restartStoryBtn">Restart the Story</button>
		&emsp; <p id="restartStoryText">  </p>
		
		&emsp; <button type="button" id="testPointBtn">Start At Point X</button>
		&emsp; <p id="testPointText">  </p>
		<br>
		<br>
		<br>
		<! -- Add Cards Buttons -->
		Add Cards to Inventory: <br>
		&emsp; Add a Non-Minted Card
		<input type="text" id="addCharacterCardInput">
		<button type="button" id="addCharacterCardButton">Add</button>
		&emsp; Example:
		&emsp; &emsp; lit_1
		&emsp; <p id="addCharacterCardText">  </p>
		
		&emsp; Add a Minted Card
		<input type="text" id="addUserCardInput">
		<button type="button" id="addUserCardButton">Add</button>
		&emsp; Example:
		&emsp; &emsp; lit_1_Minuted
		&emsp; <p id="addUserCardText">  </p>

		<script type="text/javascript">
			var playFabID = "";
			var xSecretKey = "";
			var characterID = "";

			var characterInventory = "";
			var characterCurrency = "";
			var userInventory = "";
			var userCurrency = "";
			
			
			var resetString ="{\"allWordCardsUnlocked\":false,\"inkJSONData\":\"\",\"isTutorialEnabled\":true,\"finishedNavTutorial\":false,\"lastLocationName\":\"\"}";
			var testingString = "{\"allWordCardsUnlocked\":false,\"inkJSONData\":\"{\\\"flows\\\":{\\\"DEFAULT_FLOW\\\":{\\\"callstack\\\":{\\\"threads\\\":[{\\\"callstack\\\":[{\\\"cPath\\\":\\\"A01_B01.hype_tut.0.g-2.g-3\\\",\\\"idx\\\":3,\\\"exp\\\":false,\\\"type\\\":0}],\\\"threadIndex\\\":46,\\\"previousContentObject\\\":\\\"A01_B01.hype_tut.0.g-2.g-3.2\\\"}],\\\"threadCounter\\\":46},\\\"outputStream\\\":[\\\"^[TAGS]\\\",{\\\"#\\\":\\\"savepoint\\\"},\\\"\\\\n\\\"],\\\"currentChoices\\\":[]}},\\\"currentFlowName\\\":\\\"DEFAULT_FLOW\\\",\\\"variablesState\\\":{\\\"player_name\\\":\\\"^gh\\\",\\\"issa_relationship\\\":5,\\\"show_hype\\\":true,\\\"hasNotPickedUpFirstWordCard\\\":false,\\\"show_phone\\\":true,\\\"created_character\\\":true,\\\"set_objective\\\":\\\"^A1SB1_FindIssa\\\",\\\"complete_objective\\\":\\\"^A1SB1_FindIssa\\\",\\\"uncollected_words\\\":1},\\\"evalStack\\\":[],\\\"visitCounts\\\":{\\\"\\\":1,\\\"next_storybeat\\\":1,\\\"Arc01_Beat01_MovingIn_Start\\\":1,\\\"A01_B01\\\":1,\\\"A01_B01.CC\\\":1,\\\"A01_B01.CC.0.c-0\\\":1,\\\"A01_B01.CC.0.g-0\\\":1,\\\"A01_B01.CC.0.g-0.c-1\\\":1,\\\"A01_B01.CC.0.g-1\\\":1,\\\"A01_B01.start\\\":1,\\\"A01_B01.start.0.c-0\\\":1,\\\"A01_B01.issa_intro\\\":1,\\\"A01_B01.issa_intro.0.c-0\\\":1,\\\"A01_B01.issa_intro.0.g-0\\\":1,\\\"A01_B01.get_name\\\":1,\\\"A01_B01.name_conf\\\":1,\\\"A01_B01.name_conf.0.c-0\\\":1,\\\"A01_B01.pronouns\\\":1,\\\"A01_B01.pronouns.0.c-0\\\":1,\\\"A01_B01.pronouns.0.g-0\\\":1,\\\"A01_B01.pronouns.0.g-0.c-3\\\":1,\\\"A01_B01.pronouns.0.g-1\\\":1,\\\"A01_B01.pronouns.0.g-1.c-4\\\":1,\\\"A01_B01.apt_intro\\\":1,\\\"A01_B01.apt_intro.0.g-0\\\":1,\\\"A01_B01.apt_intro.0.g-0.g-1\\\":1,\\\"A01_B01.apt_intro.0.g-0.g-1.c-0\\\":1,\\\"A01_B01.apt_intro.0.g-2\\\":1,\\\"A01_B01.apt_intro.0.g-2.c-3\\\":1,\\\"A01_B01.apt_intro.0.g-3\\\":1,\\\"A01_B01.mirror_intro\\\":1,\\\"A01_B01.mirror_intro.0.g-0\\\":1,\\\"A01_B01.mirror_intro.0.g-0.c-0\\\":1,\\\"A01_B01.mirror_intro.0.g-1\\\":1,\\\"A01_B01.mirror_intro.0.g-1.g-2\\\":1,\\\"A01_B01.mirror_intro.0.g-1.g-2.g-3\\\":1,\\\"A01_B01.mirror_intro.0.g-1.g-2.g-3.g-4\\\":1,\\\"A01_B01.mirror_intro.0.g-1.g-2.g-3.g-4.c-3\\\":1,\\\"A01_B01.mirror_intro.0.g-5\\\":1,\\\"A01_B01.mirror_intro.0.g-5.5.c-0\\\":1,\\\"A01_B01.mirror_start\\\":1,\\\"A01_B01.mirror_start.0.g-0\\\":1,\\\"A01_B01.mirror_start.0.g-0.c-0\\\":1,\\\"A01_B01.mirror_play\\\":1,\\\"A01_B01.mirror_play.0.c-0\\\":1,\\\"A01_B01.mirror_end\\\":1,\\\"A01_B01.mirror_end.0.g-0\\\":1,\\\"A01_B01.mirror_end.0.g-0.g-1\\\":1,\\\"A01_B01.mirror_end.0.g-0.g-1.c-0\\\":1,\\\"A01_B01.hype_intro\\\":1,\\\"A01_B01.hype_intro.0.g-0\\\":1,\\\"A01_B01.hype_intro.0.g-0.c-0\\\":1,\\\"A01_B01.hype_intro.0.g-1\\\":1,\\\"A01_B01.hype_intro.0.g-1.g-2\\\":1,\\\"A01_B01.hype_intro.0.g-1.g-2.c-3\\\":1,\\\"A01_B01.hype_intro.0.g-1.g-2.c-3.4.c-0\\\":1,\\\"A01_B01.hype_tut\\\":1,\\\"A01_B01.hype_tut.0.c-1\\\":1,\\\"A01_B01.hype_tut.0.g-0\\\":1,\\\"A01_B01.hype_tut.0.g-0.g-1\\\":1,\\\"A01_B01.hype_tut.0.g-0.g-1.c-3\\\":1,\\\"A01_B01.hype_tut.0.g-2\\\":1,\\\"A01_B01.hype_tut.0.g-2.g-3\\\":1},\\\"turnIndices\\\":{},\\\"turnIdx\\\":20,\\\"storySeed\\\":1,\\\"previousRandom\\\":0,\\\"inkSaveVersion\\\":9,\\\"inkFormatVersion\\\":20}\",\"isTutorialEnabled\":true,\"finishedNavTutorial\":true,\"lastLocationName\":\"\"}";
			
			$(document).ready(function(){
				
				// get the character id
				$("#getCharacterIDBtn").click(function(){
					
					playFabID = $("#PFIDInput").val();
					xSecretKey = $("#xSecretInput").val();
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GetAllUsersCharacters?PlayFabId=" + playFabID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
					    },
					};


					$.ajax(settings).done(function(response) {
						console.log(response);
						characterID = response.data.Characters[0].CharacterId;
						$("#characterIDText").text(characterID);
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey.");
					});
				});
				
				// Get the character save data
				$("#getCharacterSaveDataBtn").click(function(){
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GetCharacterData?PlayFabId=" + playFabID + "&CharacterId=" + characterID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
						},
					};

					$.ajax(settings).done(function(response) {
						console.log(response);
						$("#characterSaveDataText").text(JSON.stringify(response.data.Data, null, '\t'));
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey and generated the character id.");
					});
				});

				// Get character inventory
				$("#getCharacterInventoryBtn").click(function(){
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GetCharacterInventory?PlayFabId=" + playFabID + "&CharacterId=" + characterID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
						},
					};

					$.ajax(settings).done(function(response) {
						console.log(response);
						characterInventory = response.data.Inventory;
						characterCurrency = response.data.VirtualCurrency;
						$("#characterInventoryText").text("CARDS: \n" + JSON.stringify(characterInventory, undefined, 2) + "\n \n CURRENCY: \n" + JSON.stringify(characterCurrency, undefined, 2));
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey and generated the character id.");
					});
				});
				
				// Get user inventory
				$("#getUserInventoryBtn").click(function(){
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GetUserInventory?PlayFabId=" + playFabID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
						},
					};

					$.ajax(settings).done(function(response) {
						console.log(response);
						userInventory = response.data.Inventory;
						unserCurrency = response.data.VirtualCurrency;
						$("#characterInventoryText").text("CARDS: \n" + JSON.stringify(userInventory, undefined, 2) + "\n \n CURRENCY: \n" + JSON.stringify(userCurrency, undefined, 2));
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey and generated the character id.");
					});
				});
			
				// Restart the story
				$("#restartStoryBtn").click(function(){
		
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/UpdateCharacterData?PlayFabId=" + playFabID + "&CharacterId=" + characterID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
						},
						"data": JSON.stringify({
							"PlayFabId": playFabID,
							"Data": {
								"characterDataStoryInfo": resetString
							},
							"CharacterId": characterID
						}),
					};

					$.ajax(settings).done(function(response) {
						console.log(response);
						$("#restartStoryText").text("Success!! Hit Get All Save Data to see the results!");
						
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey and generated the character id.");
					});
				});
				
				// a random point
				$("#testPointBtn").click(function(){
		
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/UpdateCharacterData?PlayFabId=" + playFabID + "&CharacterId=" + characterID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
						},
						"data": JSON.stringify({
							"PlayFabId": playFabID,
							"Data": {
								"characterDataStoryInfo": testingString
							},
							"CharacterId": characterID
						}),
					};

					$.ajax(settings).done(function(response) {
						console.log(response);
						$("#testPointText").text("Success!! Hit Get All Save Data to see the results!");
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey and generated the character id.");
					});
				});
				
				
				// add a card to the character
				$("#addCharacterCardButton").click(function(){
					var itemID = $("#addCharacterCardInput").val();
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GrantItemsToCharacter?PlayFabId=" + playFabID + "&CharacterId=" + characterID + "&ItemIds=" + itemID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
					    },
						"data": JSON.stringify({
							"PlayFabId": playFabID,
							"CharacterId": characterID,
							"ItemIds": itemID
						}),
					};


					$.ajax(settings).done(function(response) {
						console.log(response);
						$("#addCharacterCardText").text("Success! Hit Get Character Inventory to see the results!");
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey. Also make sure the card exists.");
					});
				});
				
				// add a card to the user
				$("#addUserCardButton").click(function(){
					var itemID = $("#addUserCardInput").val();
					var settings = {
						"url": "https://1502F.playfabapi.com/Server/GrantItemsToUser?PlayFabId=" + playFabID + "&CharacterId=" + characterID + "&ItemIds=" + itemID,
						"method": "POST",
						"timeout": 0,
						"headers": {
							"Content-Type": "application/json",
							"X-SecretKey": xSecretKey
					    },
						"data": JSON.stringify({
							"PlayFabId": playFabID,
							"CharacterId": characterID,
							"ItemIds": itemID
						}),
					};


					$.ajax(settings).done(function(response) {
						console.log(response);
						$("#addUserCardText").text("Success! Hit Get User Inventory to see the results!");
					})
					.fail(function(response) {
						alert("Oops, something went wrong. Make sure you entered the correct PlayFabID and X-SecretKey. Also make sure the card exists.");
					});
				});
			});
			
			
			
		</script>
    </body>
</html>
